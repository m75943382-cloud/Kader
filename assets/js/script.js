const translations = {
    ar: {
        hero_badge: "Ù†Ø¸Ø§Ù… Ø±Ø³Ù…ÙŠ Ù…Ø¹ØªÙ…Ø¯",
        hero_title: "Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠ<br><span class='text-highlight'>Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø·Ø¨ÙŠ</span>",
        hero_subtitle: "Ø­Ù„ ØªÙ‚Ù†ÙŠ Ù…ØªÙƒØ§Ù…Ù„ ÙˆØ¢Ù…Ù† ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª<br>Ù…ØµÙ…Ù… Ø®ØµÙŠØµØ§Ù‹ Ù„Ø®Ø¯Ù…Ø© ÙƒÙ„ÙŠØ§Øª Ø§Ù„Ø·Ø¨ ÙˆÙ…Ø±Ø§ÙƒØ² Ø§Ù„ØªØ¯Ø±ÙŠØ¨",
        download_on: "ØªØ­Ù…ÙŠÙ„ Ù„Ø£Ø¬Ù‡Ø²Ø©",
        nav_lecturer: "Ù„Ù„Ù…Ø­Ø§Ø¶Ø±ÙŠÙ†",

        // How It Works
        how_it_works_title: "ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…",
        step_open: "ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚",
        step_connect: "ØªÙ„Ø§Ù…Ø³ Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø±",
        step_done: "ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",

        // Features
        feat_secure_title: "Ø¢Ù…Ù† ÙˆÙ…ÙˆØ«ÙˆÙ‚",
        feat_secure_desc: "ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªÙ‚Ù†ÙŠØ§Øª Ù…Ø´ÙØ±Ø© Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
        feat_offline_title: "ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª",
        feat_offline_desc: "Ù„Ø§ ÙŠØ´ØªØ±Ø· Ø§ØªØµØ§Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±",
        feat_tech_title: "ØªÙ‚Ù†ÙŠØ§Øª Ø­Ø¯ÙŠØ«Ø©",
        feat_tech_desc: "Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„ØªÙ‚Ù†ÙŠØ§Øª NFC Ùˆ Bluetooth",
        feat_dashboard_title: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…ØªÙ‚Ø¯Ù…Ø©",
        feat_dashboard_desc: "ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ø­Ø¸ÙŠØ© ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø¤Ø³Ø³Ø§Øª",

        // Institutions
        inst_badge: "Ù„Ù„Ù…Ø¤Ø³Ø³Ø§Øª",
        inst_title: "Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ù…Ø¤Ø³Ø³ØªÙƒ",
        inst_desc: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…ØªÙ‚Ø¯Ù…Ø© ØªÙ…ÙƒÙ†Ùƒ Ù…Ù† Ù…ØªØ§Ø¨Ø¹Ø© Ù†Ø³Ø¨ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ø­Ø¸ÙŠØ§Ù‹ ÙˆØªØµØ¯ÙŠØ± ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠØ© Ù„ÙƒÙ„ ÙƒÙˆØ±Ø³ ÙˆÙ…Ø¬Ù…ÙˆØ¹Ø© ÙˆÙ…Ø­Ø§Ø¶Ø± ÙˆÙ…ØªØ¹Ù„Ù…",
        inst_feat1: "Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ø­Ø¸ÙŠØ© Ù„Ù„Ø­Ø¶ÙˆØ±",
        inst_feat2: "ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØµØ¯ÙŠØ±",
        inst_feat3: "Ø¥Ø¯Ø§Ø±Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±ÙŠÙ†",
        inst_cta: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",

        footer_copy: "ÙƒØ§Ø¯Ø± 2024 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©",
        support_btn: "Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ",

        // Modal
        modal_title: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù„Ù‰ iPhone",
        step1_title: "Ø®Ø·ÙˆØ© 1: ØªØ­Ù…ÙŠÙ„ TestFlight",
        step1_desc: "ÙŠØ¬Ø¨ ØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ TestFlight Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ù…ØªØ¬Ø± Ø£Ø¨Ù„ Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† ØªØ«Ø¨ÙŠØª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©",
        btn_download_testflight: "ØªØ­Ù…ÙŠÙ„ TestFlight",
        step2_title: "Ø®Ø·ÙˆØ© 2: ØªØ­Ù…ÙŠÙ„ BardiMad",
        step2_desc: "Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙˆØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·Ø§Ù„Ø¨",
        btn_download_app: "ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø·Ù„Ø§Ø¨)",
        btn_next: "Ø§Ù„ØªØ§Ù„ÙŠ",
        lang_btn_text: "English",
        download_started: "ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†Ø²ÙŠÙ„! ØªÙÙ‚Ø¯ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªÙ†Ø²ÙŠÙ„Ø§Øª ğŸ“¥"
    },
    en: {
        hero_badge: "Official Certified System",
        hero_title: "Smart Attendance System<br><span class='text-highlight'>For Medical Education</span>",
        hero_subtitle: "Integrated Secure Offline-First Solution<br>Designed for Medical Faculties and Training Centers",
        download_on: "Download for",
        nav_lecturer: "For Lecturers",

        // How It Works
        how_it_works_title: "How It Works",
        step_open: "Open App",
        step_connect: "Touch or Select",
        step_done: "Registered",

        // Features
        feat_secure_title: "Secure & Reliable",
        feat_secure_desc: "Uses encrypted technologies to ensure data accuracy",
        feat_offline_title: "Works Offline",
        feat_offline_desc: "Student internet connection not required",
        feat_tech_title: "Modern Tech",
        feat_tech_desc: "Full support for NFC and Bluetooth technologies",
        feat_dashboard_title: "Advanced Dashboard",
        feat_dashboard_desc: "Real-time reports and comprehensive statistics for institutions",

        // Institutions
        inst_badge: "For Institutions",
        inst_title: "Centralized Management",
        inst_desc: "An advanced dashboard that enables you to monitor attendance rates in real-time and export detailed reports for each course, group, lecturer, and learner",
        inst_feat1: "Real-time attendance monitoring",
        inst_feat2: "Exportable detailed reports",
        inst_feat3: "Lecturer permissions management",
        inst_cta: "Contact Us",

        footer_copy: "Kader System 2024 All Rights Reserved",
        support_btn: "Technical Support",

        // Modal
        modal_title: "Installation on iPhone",
        step1_title: "Step 1: Download TestFlight",
        step1_desc: "Download TestFlight from the Apple Store to install the beta version",
        btn_download_testflight: "Download TestFlight",
        step2_title: "Step 2: Download BardiMad",
        step2_desc: "Join the beta and download the student app",
        btn_download_app: "Download App (Student)",
        btn_next: "Next",
        lang_btn_text: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
        download_started: "Download started! Check your Downloads folder ğŸ“¥"
    }
};

document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const langToggle = document.getElementById('lang-toggle');
    const themeToggle = document.getElementById('theme-toggle');
    const currentLangText = document.getElementById('current-lang-text');
    const html = document.documentElement;

    // Modal Elements
    const btnIos = document.getElementById('btn-ios');
    const modal = document.getElementById('ios-modal');
    const modalClose = document.querySelector('.modal-close');
    const btnNext = document.getElementById('btn-next-step');
    const btnAndroid = document.getElementById('btn-android');

    const step1Content = document.getElementById('step-1');
    const step2Content = document.getElementById('step-2');
    const step1Indicator = document.getElementById('step-1-indicator');
    const step2Indicator = document.getElementById('step-2-indicator');

    // State
    let currentLang = 'ar';
    let currentTheme = localStorage.getItem('theme') || 'light';

    // Initialize Theme
    setTheme(currentTheme);

    // 4. Mobile Menu Toggle
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mainNav = document.getElementById('main-nav');

    if (mobileMenuToggle && mainNav) {
        mobileMenuToggle.addEventListener('click', () => {
            mainNav.classList.toggle('active');

            // Toggle icon between menu and X
            const icon = mobileMenuToggle.querySelector('i');
            if (icon) {
                if (mainNav.classList.contains('active')) {
                    icon.setAttribute('data-lucide', 'x');
                } else {
                    icon.setAttribute('data-lucide', 'menu');
                }
                lucide.createIcons();
            }
        });

        // Close menu when clicking a nav link
        mainNav.querySelectorAll('.nav-link, .btn-ghost').forEach(link => {
            link.addEventListener('click', () => {
                mainNav.classList.remove('active');
                const icon = mobileMenuToggle.querySelector('i');
                if (icon) {
                    icon.setAttribute('data-lucide', 'menu');
                    lucide.createIcons();
                }
            });
        });
    }

    // 1. Theme Logic
    themeToggle.addEventListener('click', () => {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        setTheme(currentTheme);
    });

    function setTheme(theme) {
        html.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);

        // Update Icon
        const icon = themeToggle.querySelector('i');
        if (icon) {
            if (theme === 'dark') {
                icon.setAttribute('data-lucide', 'sun');
            } else {
                icon.setAttribute('data-lucide', 'moon');
            }
            lucide.createIcons();
        }
    }

    // 2. Language Switcher
    langToggle.addEventListener('click', () => {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        updateLanguage(currentLang);
    });

    function updateLanguage(lang) {
        // Update HTML dir and lang
        html.lang = lang;
        html.dir = lang === 'ar' ? 'rtl' : 'ltr';

        // Update Text
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[lang][key]) {
                element.innerHTML = translations[lang][key];
            }
        });

        // Update Button Text
        currentLangText.textContent = translations[lang].lang_btn_text;

        // Update Lucide Icons (in case they need re-rendering, though mostly unrelated to lang)
        lucide.createIcons();
    }

    // 3. Modal Interactions
    if (btnIos) {
        btnIos.addEventListener('click', () => {
            modal.classList.remove('hidden');
            resetModal();
        });
    }

    if (modalClose) {
        modalClose.addEventListener('click', () => {
            modal.classList.add('hidden');
        });
    }

    // Close on click outside
    if (modal) {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });
    }

    // Step Navigation
    if (btnNext) {
        btnNext.addEventListener('click', () => {
            // Switch to Step 2
            step1Content.classList.add('hidden');
            step2Content.classList.remove('hidden');

            step1Indicator.classList.remove('active');
            step1Indicator.innerHTML = '<i data-lucide="check" style="width:16px"></i>';
            step2Indicator.classList.add('active');

            btnNext.style.display = 'none'; // Hide next button on last step
            lucide.createIcons();
        });
    }

    function resetModal() {
        step1Content.classList.remove('hidden');
        step2Content.classList.add('hidden');

        step1Indicator.classList.add('active');
        step1Indicator.textContent = '1';
        step2Indicator.classList.remove('active');
        step1Indicator.innerHTML = '1';

        btnNext.style.display = 'inline-block';
        lucide.createIcons();
    }

    // Toast Notification Function
    function showToast(message) {
        // Remove existing toast if any
        const existingToast = document.querySelector('.toast-notification');
        if (existingToast) {
            existingToast.remove();
        }

        // Create toast element
        const toast = document.createElement('div');
        toast.className = 'toast-notification';
        toast.innerHTML = `
            <i data-lucide="download" class="toast-icon"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(toast);
        lucide.createIcons();

        // Show toast
        setTimeout(() => toast.classList.add('show'), 100);

        // Hide and remove after 4 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 4000);
    }

    // Android Download Button - Show Toast
    if (btnAndroid) {
        btnAndroid.addEventListener('click', () => {
            const message = translations[currentLang].download_started;
            showToast(message);
        });
    }
});
